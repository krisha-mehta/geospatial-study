<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Pixel Maps</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../../revisitUtilities/revisit-communicate.js"></script>
    <style>
      svg {
        width: 100%;
        height: auto;
      }
      path {
        cursor: pointer;
        transition: fill 0.2s;
        fill: transparent; 
        pointer-events: fill;
    }
    </style>
  </head>

  <body>
    <div id="container"></div>

    <script>
      // Receive data from reVISit
      Revisit.onDataReceive((data) => {
        const svgFile = data['svgFile']; 
        const taskID = 'selectedCounty'; 

        d3.xml(svgFile).then(svgData => {
          const svgNode = document.importNode(svgData.documentElement, true);
          document.getElementById("container").appendChild(svgNode);

          d3.select(svgNode).selectAll("path")
            .on("mouseover", function () {
              d3.select(this).attr("fill", "orange");
            })
            .on("mouseout", function () {
              d3.select(this).attr("fill", null); 
            })
            .on("click", function () {
              const countyId = d3.select(this).attr("id");
              d3.selectAll(this).attr("fill", "red");

              Revisit.postAnswers({
                [taskID]: countyId,
              });

              console.log("Selected County:", countyId);
            });

        }).catch(err => {
          console.error("Error loading SVG:", err);
        });
      });
    </script>
  </body>
</html>
